"use strict";!function(t,s,a){var r={elements:{table:null,form:null,market_cap_slider:null,price_slider:null,volume_slider:null,reset_sliders:null,coins_selection:null,coins_clear:null,save_checkbox:null},currency_url:null,sliders_alias:{market_cap:"mc",price:"p",volume:"v"},sliders:{},search_params:{c:null,mcf:null,mct:null,pf:null,pt:null,vf:null,vt:null},form_params:{save:!1},save_cookie:"ct_market_search_save",price_spans:{},init:function(){this.buildCharts(),this.initDataTable(),this.initSearchForm()},buildCharts:function(){var e;t.slugs&&t.slugs.length&&(e={slugs:t.slugs.join(",")},s.getJSON(t.urls.api+"/charts_7d",e,function(n){Object.keys(n).forEach(e=>{var i="chart-"+e,s=n[e];s.series.length&&(e=s.series.map(function(e){return{type:"line",showSymbol:!1,animation:!1,lineStyle:{color:e.color,width:1},areaStyle:{color:e.color,opacity:.5},data:e.data}}),a.init(document.getElementById(i),{width:200}).setOption({xAxis:{show:!1,type:"category",data:s.x},yAxis:{type:"value",min:"dataMin",max:"dataMax",show:!1},series:e}))})}))},initDataTable:function(){this.elements.table.DataTable({paging:!1,scrollX:!0,searching:!1,ordering:!1,info:!1})},initSearchForm:function(){var e=this.elements.form;r.form_params;this.initSave(),this.initSearchSliders(),this.initCoinSelection(),e.find(".ui.accordion").accordion(),e.find(".submit-button").on("click",function(){r.search()})},initCoinSelection:function(){var e=this.elements;t.params.c?s.getJSON(t.urls.api+"/coins/search",{c:t.params.c||[]},function(e){e&&e.success&&Array.isArray(e.results)&&(e.results.forEach(e=>e.selected=!0),r.initCoinSelectionDropdown(e.results))}):r.initCoinSelectionDropdown([]),e.coins_clear.on("click",function(){e.coins_selection.dropdown("clear"),r.search_params.c=null})},initCoinSelectionDropdown:function(e){this.elements.coins_selection.dropdown({values:e,clearable:!0,forceSelection:!1,apiSettings:{url:t.urls.api+"/coins/search?q={query}"},onChange:function(e){e.length&&e!==r.search_params.c&&(r.search_params.c=e)}})},_initCoinSelection:function(){var s=this.elements;this.coinList(function(e){var i=t.params.c;Array.isArray(i)&&e.forEach(function(e){-1!==i.indexOf(e.value)&&(e.selected=!0)}),s.coins_selection.dropdown({values:e,clearable:!0,forceSelection:!1,onChange:function(e){e.length&&e!==r.search_params.c&&(r.search_params.c=e)}})}),s.coins_clear.on("click",function(){s.coins_selection.dropdown("clear"),r.search_params.c=null})},initSearchSliders:function(){var a=this.elements;Object.keys(this.sliders_alias).forEach(function(i){var e=i+"_slider",s=t[e],n=function(e){r.setSearchFrom(i,e.min===e.from?null:e.from_value),r.setSearchTo(i,e.max===e.to?null:e.to_value)},n={values:s.values,onUpdate:n,onChange:n};s.hasOwnProperty("from")&&(n.from=s.from,r.setSearchFrom(i,s.values[s.from])),s.hasOwnProperty("to")&&(n.to=s.to,r.setSearchTo(i,s.values[s.to])),a[e].ionRangeSlider(n),r.sliders[i]=a[e].data("ionRangeSlider")}),a.reset_sliders.on("click",function(){Object.keys(r.sliders).forEach(function(e){r.sliders[e].update({to:null,from:null})})})},initSave:function(){this.elements.save_checkbox.checkbox({onChecked:function(){r.setSave(!0)},onUnchecked:function(){r.setSave(!1)}}).checkbox(this.getSaveCookie()?"check":"uncheck")},setSearchFrom:function(e,i){this.search_params[this.sliders_alias[e]+"f"]=i},setSearchTo:function(e,i){this.search_params[this.sliders_alias[e]+"t"]=i},setSave:function(e){s.cookie(this.save_cookie,e,{path:"/"}),this.form_params.save=e},getSaveCookie:function(){return"true"===s.cookie(this.save_cookie)},search:function(){var s=[];Object.keys(this.search_params).forEach(function(e){var i=r.search_params[e];null!==i&&s.push(e+"="+i)}),s.push("order="+t.params.order),s.push("desc="+(t.params.order?1:0)),location.href=t.urls.market_page+"?"+s.join("&")},coinList:function(i){var e=t.urls.api+"/coins/list";s.getJSON(e,function(e){e&&i(e)})}};s(function(){var e=r.elements;e.table=s("#market-table"),e.form=s("#market-form"),e.market_cap_slider=s("#market-cap-slider"),e.price_slider=s("#price-slider"),e.volume_slider=s("#volume-slider"),e.reset_sliders=s("#reset-sliders"),e.coins_selection=s("#coins-selection"),e.coins_clear=s("#coins-clear"),e.save_checkbox=s("#save-checkbox"),r.init()})}(window.CoinTableConstants,jQuery,(fx,echarts));